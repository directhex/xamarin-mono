From c82f072f24b68c25068c2c1ddf76ebb84bb8f5e3 Mon Sep 17 00:00:00 2001
From: Joseph Shields <directhex@apebox.org>
Date: Fri, 26 Jun 2020 16:03:59 -0400
Subject: [PATCH] Revert "[2019-12] Force Python 3.x from env in shebang lines
 (#19423)"

This reverts commit 8199a27e287fce5dea0a8c79570c3e804aee6da0.
---
 configure.ac                                   |  1 -
 mono/mini/Makefile.am.in                       |  2 +-
 mono/mini/genmdesc.py                          |  2 +-
 mono/tests/Makefile.am                         |  2 +-
 .../gc-descriptors/gen-descriptor-tests.py     |  2 +-
 mono/tests/test_lldb.py                        |  2 +-
 netcore/Makefile                               |  4 ++--
 scripts/ci/babysitter                          |  6 +++---
 scripts/mono-heapviz                           |  2 +-
 scripts/submodules/versions.mk                 | 18 +++++++++---------
 scripts/submodules/versions.py                 |  2 +-
 sdks/builds/android.mk                         |  2 +-
 sdks/wasm/Makefile                             |  4 ++--
 sdks/wasm/print-table.py                       |  2 +-
 tools/sgen/gcpausevis.py                       |  2 +-
 15 files changed, 26 insertions(+), 27 deletions(-)

diff --git a/configure.ac b/configure.ac
index 59ba2a083f2..d9d5c55e743 100644
--- a/configure.ac
+++ b/configure.ac
@@ -605,7 +605,6 @@ AC_CHECK_TOOL(CC, gcc, gcc)
 AC_PROG_CC
 AC_CHECK_TOOL(CXX, g++, g++)
 AC_PROG_CXX
-AM_PATH_PYTHON([3.2])
 AM_PROG_AS
 AC_PROG_INSTALL
 AC_PROG_AWK
diff --git a/mono/mini/Makefile.am.in b/mono/mini/Makefile.am.in
index 972a09df21b..e7d5b6daca8 100755
--- a/mono/mini/Makefile.am.in
+++ b/mono/mini/Makefile.am.in
@@ -825,7 +825,7 @@ MemoryIntrinsics.dll: MemoryIntrinsics.il
 
 GENMDESC_OPTS=
 
-GENMDESC_PRG=$(PYTHON) $(srcdir)/genmdesc.py $(target_define) $(srcdir)
+GENMDESC_PRG=python $(srcdir)/genmdesc.py $(target_define) $(srcdir)
 
 cpu-wasm.h: mini-ops.h cpu-wasm.md $(srcdir)/genmdesc.py
 	$(GENMDESC_PRG) cpu-wasm.h wasm_desc $(srcdir)/cpu-wasm.md
diff --git a/mono/mini/genmdesc.py b/mono/mini/genmdesc.py
index 7a20260e81e..79a110bfb6a 100755
--- a/mono/mini/genmdesc.py
+++ b/mono/mini/genmdesc.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python3
+#!/usr/bin/env python
 
 #
 # This tool is used to generate the cpu-<ARCH>.h files used by the JIT. The input is the
diff --git a/mono/tests/Makefile.am b/mono/tests/Makefile.am
index 54947b9ffc1..323ca18627f 100755
--- a/mono/tests/Makefile.am
+++ b/mono/tests/Makefile.am
@@ -3186,7 +3186,7 @@ coreclr-gcstress:
 # Tests for the Mono lldb plugin
 EXTRA_DIST += test_lldb.py test-lldb.cs
 test-lldb: test-lldb.exe
-	$(PYTHON) test_lldb.py $(JITTEST_PROG)
+	python test_lldb.py $(JITTEST_PROG)
 
 if !ENABLE_MSVC_ONLY
 
diff --git a/mono/tests/gc-descriptors/gen-descriptor-tests.py b/mono/tests/gc-descriptors/gen-descriptor-tests.py
index bbc260bd557..4dc0e469a7f 100755
--- a/mono/tests/gc-descriptors/gen-descriptor-tests.py
+++ b/mono/tests/gc-descriptors/gen-descriptor-tests.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python3
+#!/usr/bin/env python
 
 from __future__ import print_function
 from optparse import OptionParser
diff --git a/mono/tests/test_lldb.py b/mono/tests/test_lldb.py
index 0c637e62a6a..eb557108a6f 100644
--- a/mono/tests/test_lldb.py
+++ b/mono/tests/test_lldb.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python3
+#!/usr/bin/python
 
 import os
 import sys
diff --git a/netcore/Makefile b/netcore/Makefile
index 98776402884..aefc670ccd0 100755
--- a/netcore/Makefile
+++ b/netcore/Makefile
@@ -19,7 +19,7 @@ ifeq ($(HOST_PLATFORM),win32)
 PLATFORM_AOT_SUFFIX := .dll
 PLATFORM_AOT_PREFIX :=
 NETCORESDK_EXT = zip
-UNZIPCMD = $(PYTHON) -c "import zipfile,sys; zipfile.ZipFile(sys.argv[1], 'r').extractall()"
+UNZIPCMD = python -c "import zipfile,sys; zipfile.ZipFile(sys.argv[1], 'r').extractall()"
 XUNIT_INNER_ARGS = -notrait category=nonwindowstests @../../../../CoreFX.issues_windows.rsp
 TESTS_PLATFORM = Windows_NT.x64
 ON_RUNTIME_EXTRACT = chmod -R 755 {host,shared,./dotnet}
@@ -320,4 +320,4 @@ jitdiff:
 	cd tools/jitdiff && $(DOTNET) run -c Release -- "$(BEFORE)" "$(AFTER)"
 
 distdir:
-distclean:
+distclean:
\ No newline at end of file
diff --git a/scripts/ci/babysitter b/scripts/ci/babysitter
index 90e5f965863..8ec3579e0b9 100755
--- a/scripts/ci/babysitter
+++ b/scripts/ci/babysitter
@@ -1,4 +1,4 @@
-#!/usr/bin/env python3
+#!/usr/bin/env python
 
 # Mimics GNU timeout, but has special modes which gather test result data and retry failed tests.
 
@@ -184,12 +184,12 @@ cygwin = platform.system().startswith("CYGWIN")
 
 def outgoingPath(path):
 	if cygwin: # Invoke cygpath and strip newline
-		return subprocess.check_output(["cygpath", "-w", path])[:-1].decode(sys.stdin.encoding)
+		return subprocess.check_output(["cygpath", "-w", path])[:-1]
 	return path
 
 def incomingPath(path):
 	if cygwin:
-		return subprocess.check_output(["cygpath", path])[:-1].decode(sys.stdin.encoding)
+		return subprocess.check_output(["cygpath", path])[:-1]
 	return path
 
 # Some of the things we put in global_env are paths. If we're in cygwin, we have to keep separate
diff --git a/scripts/mono-heapviz b/scripts/mono-heapviz
index c4a4847bbe6..27b6f7f6023 100755
--- a/scripts/mono-heapviz
+++ b/scripts/mono-heapviz
@@ -1,4 +1,4 @@
-#!/usr/bin/env python3
+#!/usr/bin/env python
 
 # Generate a heap visualization for SGen from the heap dump written by
 # mono if the MONO_GC_DEBUG is set to something like
diff --git a/scripts/submodules/versions.mk b/scripts/submodules/versions.mk
index a47c2d56783..899b09de01a 100644
--- a/scripts/submodules/versions.mk
+++ b/scripts/submodules/versions.mk
@@ -1,5 +1,5 @@
 #
-# This is a Python script and a set of make targets to implement support for conditional submodules
+# This is a python script and a set of make targets to implement support for conditional submodules
 # Set the SUBMODULES_CONFIG_FILE make variable to the srcdir path of a SUBMODULES.json file which contains information about the submodules.
 #
 
@@ -10,11 +10,11 @@ SCRIPT=$(top_srcdir)/scripts/submodules/versions.py
 
 define ValidateVersionTemplate
 #$(eval REPOSITORY_$(2):=$(shell test -z $(3) && echo $(1) || echo "$(3)"))
-#$(eval DIRECTORY_$(2):=$(shell $(PYTHON) $(SCRIPT) $(SUBMODULES_CONFIG_FILE) get-dir $(1)))
+#$(eval DIRECTORY_$(2):=$(shell python $(SCRIPT) $(SUBMODULES_CONFIG_FILE) get-dir $(1)))
 #$(eval DIRECTORY_$(2):=$(shell test -z $(DIRECTORY_$(2)) && echo $(1) || echo $(DIRECTORY_$(2))))
-#$(eval MODULE_$(2):=$(shell $(PYTHON) $(SCRIPT) $(SUBMODULES_CONFIG_FILE) get-url $(1)))
-#$(eval NEEDED_$(2)_VERSION:=$(shell $(PYTHON) $(SCRIPT) $(SUBMODULES_CONFIG_FILE) get-rev $(1)))
-#$(eval $(2)_BRANCH_AND_REMOTE:=$(shell $(PYTHON) $(SCRIPT) $(SUBMODULES_CONFIG_FILE) get-remote-branch $(1)))
+#$(eval MODULE_$(2):=$(shell python $(SCRIPT) $(SUBMODULES_CONFIG_FILE) get-url $(1)))
+#$(eval NEEDED_$(2)_VERSION:=$(shell python $(SCRIPT) $(SUBMODULES_CONFIG_FILE) get-rev $(1)))
+#$(eval $(2)_BRANCH_AND_REMOTE:=$(shell python $(SCRIPT) $(SUBMODULES_CONFIG_FILE) get-remote-branch $(1)))
 
 #$(eval $(2)_VERSION:=$$$$(shell cd $($(2)_PATH) 2>/dev/null && git rev-parse HEAD ))
 
@@ -106,17 +106,17 @@ reset:
 
 __bump-version-%:
 	@if [ "$(REV)" = "" ]; then echo "Usage: make bump-version-$* REV=<ref>"; exit 1; fi
-	$(PYTHON) $(SCRIPT) $(SUBMODULES_CONFIG_FILE) set-rev $* $(REV)
+	python $(SCRIPT) $(SUBMODULES_CONFIG_FILE) set-rev $* $(REV)
 	@if [ "$(COMMIT)" = "1" ]; then echo "[submodules] Bump $* to pick up $(REV)." | git commit -F - $(SUBMODULES_CONFIG_FILE); fi
 
 __bump-branch-%:
 	@if [ "$(BRANCH)" = "" ]; then echo "Usage: make bump-branch-$* BRANCH=<branch> REMOTE_BRANCH=<remote branch>"; exit 1; fi
 	@if [ "$(REMOTE_BRANCH)" == "" ]; then echo "Usage: make bump-branch-$* BRANCH=<branch> REMOTE_BRANCH=<remote branch>"; exit 1; fi
-	$(PYTHON) $(SCRIPT) $(SUBMODULES_CONFIG_FILE) set-branch $* $(BRANCH)
-	$(PYTHON) $(SCRIPT) $(SUBMODULES_CONFIG_FILE) set-remote-branch $* $(REMOTE_BRANCH)
+	python $(SCRIPT) $(SUBMODULES_CONFIG_FILE) set-branch $* $(BRANCH)
+	python $(SCRIPT) $(SUBMODULES_CONFIG_FILE) set-remote-branch $* $(REMOTE_BRANCH)
 	@if [ "$(COMMIT)" = "1" ]; then echo "[submodules] Bump $* to switch to $(BRANCH) $(REMOTE BRANCH)." | git commit -F - $(SUBMODULES_CONFIG_FILE); fi
 
 __bump-current-version-%:
 	REV=$(shell cd $(ACCEPTANCE_TESTS_PATH)/$* && git log -1 --pretty=format:%H); \
-	$(PYTHON) $(SCRIPT) $(SUBMODULES_CONFIG_FILE) set-rev $* $$REV; \
+	python $(SCRIPT) $(SUBMODULES_CONFIG_FILE) set-rev $* $$REV; \
 	if [ "$(COMMIT)" = "1" ]; then echo "[submodules] Bump $* to pick up $$REV:" | git commit -F - $(SUBMODULES_CONFIG_FILE); fi
diff --git a/scripts/submodules/versions.py b/scripts/submodules/versions.py
index 44994d23ff7..5252ee58306 100755
--- a/scripts/submodules/versions.py
+++ b/scripts/submodules/versions.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python3
+#!/usr/bin/env python
 
 import sys
 import json
diff --git a/sdks/builds/android.mk b/sdks/builds/android.mk
index ad62ec01f12..db488ed208c 100644
--- a/sdks/builds/android.mk
+++ b/sdks/builds/android.mk
@@ -155,7 +155,7 @@ _android-$(1)_CONFIGURE_FLAGS= \
 	--disable-crash-reporting
 
 .stamp-android-$(1)-toolchain: | $$(if $$(IGNORE_PROVISION_ANDROID),,provision-android)
-	$(PYTHON) "$$(ANDROID_TOOLCHAIN_DIR)/ndk/build/tools/make_standalone_toolchain.py" --verbose --force --api=$$(ANDROID_SDK_VERSION_$(1)) --arch=$(2) --install-dir=$$(ANDROID_TOOLCHAIN_PREFIX)/$(1)-clang
+	python "$$(ANDROID_TOOLCHAIN_DIR)/ndk/build/tools/make_standalone_toolchain.py" --verbose --force --api=$$(ANDROID_SDK_VERSION_$(1)) --arch=$(2) --install-dir=$$(ANDROID_TOOLCHAIN_PREFIX)/$(1)-clang
 	touch $$@
 
 $$(eval $$(call RuntimeTemplate,android,$(1),$(4)))
diff --git a/sdks/wasm/Makefile b/sdks/wasm/Makefile
index 039c842cae3..fba9e96bb5a 100644
--- a/sdks/wasm/Makefile
+++ b/sdks/wasm/Makefile
@@ -491,7 +491,7 @@ build-interp-sample: packager.exe hello.exe
 build-io-sample: packager.exe hello-io.exe
 	$(PACKAGER) --emscripten-sdkdir=$(EMSCRIPTEN_SDK_DIR) --mono-sdkdir=$(TOP)/sdks/out -appdir=bin/io-sample --builddir=obj/io-sample --template=runtime.js --asset=hello-io.html --enable-fs hello-io.exe
 	ninja -v -C obj/io-sample
-	(cd bin/io-sample && $(PYTHON) $(EMSCRIPTEN_SDK_DIR)/upstream/emscripten/tools/file_packager.py mono.dat --js-output=mono-loader.js --preload ../../hello-io.cs@/)
+	(cd bin/io-sample && python $(EMSCRIPTEN_SDK_DIR)/upstream/emscripten/tools/file_packager.py mono.dat --js-output=mono-loader.js --preload ../../hello-io.cs@/)
 
 run-interp-sample: build-interp-sample
 	(cd bin/interp-sample && $(SM) runtime.js --run hello.exe)
@@ -722,7 +722,7 @@ package: build build-sdk build-dbg-proxy
 	rm -rf tmp
 
 serve:
-	$(PYTHON) server.py
+	python server.py
 
 canary:
 	/Applications/Google\ Chrome\ Canary.app/Contents/MacOS/Google\ Chrome\ Canary --remote-debugging-port=9222
diff --git a/sdks/wasm/print-table.py b/sdks/wasm/print-table.py
index e879073696d..d18faa143b5 100755
--- a/sdks/wasm/print-table.py
+++ b/sdks/wasm/print-table.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python3
+#!/usr/bin/python
 
 #
 # print-table.py: Print the function table for a webassembly .wast file
diff --git a/tools/sgen/gcpausevis.py b/tools/sgen/gcpausevis.py
index 2cc2f29fffd..27eb6276fad 100755
--- a/tools/sgen/gcpausevis.py
+++ b/tools/sgen/gcpausevis.py
@@ -1,4 +1,4 @@
-#!/usr/bin/env python3
+#!/usr/bin/env python
 import matplotlib.pyplot as plt
 from matplotlib.dates import DateFormatter, MinuteLocator, SecondLocator
 import numpy as np
-- 
2.26.2

